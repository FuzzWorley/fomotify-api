{
  "api-key": "$CONDUCTOR_API_KEY",
  "enable-db": false,
  "app-json": {
    "id": "/$BERLIOZ_GROUP/$BERLIOZ_NAME/$BERLIOZ_SUBGROUP",
    "cpus": 0.1,
    "mem": 64,
    "instances": 1,
    "constraints": [["hostname", "UNIQUE"], ["az", "GROUP_BY", "3"]],
    "env": {
        "RAILS_ENV": "production",
        "RACK_ENV": "production",
        "SERVICE_4567_NAME": "$SERVICE_NAME",
        "SERVICE_4567_TAGS": "public",
        "SERVICE_4567_CHECK_HTTP": "/products.json",
        "SERVICE_4567_CHECK_INTERVAL": "20s",
        "SERVICE_4567_CHECK_TIMEOUT": "10s"
      },
    "container": {
      "type": "DOCKER",
      "docker": {
        "image": "$DOCKER_REPO:$VERSION",
        "network": "BRIDGE",
        "parameters": [
          {
            "key": "log-driver",
            "value": "syslog"
          },
          {
            "key": "log-opt",
            "value": "syslog-address=tcp://logstash.service.consul:5544"
          },
          {
            "key": "log-opt",
            "value": "syslog-tag=$SERVICE_NAME"
          }
        ]
        ,
          "portMappings": [
            {
              "containerPort": 4567,
              "hostPort": 0,
              "protocol": "tcp"
            }
          ]
        }
    },
    "uris": [
      "http://marathon.service.consul:8080/v2/artifacts/etc/.dockercfg"
    ],
    "healthChecks": [
      {
        "path": "/products.json",
        "portIndex": 0,
        "protocol": "HTTP",
        "gracePeriodSeconds": 600,
        "intervalSeconds": 20,
        "timeoutSeconds": 10,
        "maxConsecutiveFailures": 3,
        "ignoreHttp1xx": false
      }
    ],
    "upgradeStrategy": {
       "minimumHealthCapacity": 1,
       "maximumOverCapacity": 0
    },
    "backoffFactor": 1.5,
    "backoffSeconds": 1,
    "maxLaunchDelaySeconds": 3600
  }
}
